<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>SITsense Table Booking</title>
<style>
  /* (CSS แบบที่ส่งมาก่อนหน้าเลย ใช้ได้) */
</style>
</head>
<body>

<h1>SITsense</h1>

<div id="mainPage">
  <div class="table-card" id="table1">
    <div class="table-name">Table 1</div>
    <p>Status: <span id="status1" class="status">AVAILABLE</span></p>
    <p>Name: <span id="name1">-</span></p>
    <button onclick="goToLogin(1)">Login</button>
    <button onclick="goToLogout(1)">Logout</button>
  </div>
</div>

<div id="loginPage" class="hidden">
  <h2>Login</h2>
  <input id="nameInput" placeholder="ชื่อ">
  <input id="studentIDInput" placeholder="รหัสนักศึกษา">
  <input id="emailInput" placeholder="Email">
  <button onclick="confirmLogin()">ยืนยัน</button>
  <button onclick="showMainPage()">ยกเลิก</button>
</div>

<div id="logoutPage" class="hidden">
  <h2>Logout</h2>
  <input id="logoutStudentIDInput" placeholder="รหัสนักศึกษา">
  <button onclick="confirmLogout()">ยืนยัน</button>
  <button onclick="showMainPage()">ยกเลิก</button>
</div>

<script>
const scriptURL = 'https://script.google.com/macros/s/AKfycbz3BAoUZr7_uy2BFocspCqgMlf9lfM_fcUea4J6LWBlinNBR6KjIk2HKNI5sblC6T0/exec'; // ใส่ของตัวเอง
let selectedTable = 1;

function goToLogin(table) {
  selectedTable = table;
  document.getElementById('mainPage').classList.add('hidden');
  document.getElementById('loginPage').classList.remove('hidden');
}

function goToLogout(table) {
  selectedTable = table;
  document.getElementById('mainPage').classList.add('hidden');
  document.getElementById('logoutPage').classList.remove('hidden');
}

function showMainPage() {
  document.getElementById('loginPage').classList.add('hidden');
  document.getElementById('logoutPage').classList.add('hidden');
  document.getElementById('mainPage').classList.remove('hidden');
  updateUI();
}

function confirmLogin() {
  const name = document.getElementById('nameInput').value.trim();
  const studentID = document.getElementById('studentIDInput').value.trim();
  const email = document.getElementById('emailInput').value.trim();

  if (!name || !studentID || !email) {
    alert('กรุณากรอกข้อมูลให้ครบ');
    return;
  }

  const data = new URLSearchParams();
  data.append('table', selectedTable);
  data.append('status', 'จองแล้ว');
  data.append('name', name);
  data.append('studentID', studentID);
  data.append('email', email);

  fetch(scriptURL, {
    method: 'POST',
    body: data
  }).then(response => response.text())
    .then(result => {
      showMainPage();
    }).catch(error => {
      alert('error: ' + error);
    });
}

function confirmLogout() {
  const studentID = document.getElementById('logoutStudentIDInput').value.trim();

  fetch(scriptURL)
    .then(response => response.json())
    .then(data => {
      if (data.name && studentID === data.name) {
        const logoutData = new URLSearchParams();
        logoutData.append('table', selectedTable);
        logoutData.append('status', 'ว่าง');
        logoutData.append('name', '');
        logoutData.append('studentID', '');
        logoutData.append('email', '');

        fetch(scriptURL, {
          method: 'POST',
          body: logoutData
        }).then(() => {
          showMainPage();
        });
      } else {
        alert('รหัสนักศึกษาไม่ถูกต้อง');
      }
    });
}

function updateUI() {
  fetch(scriptURL)
    .then(response => response.json())
    .then(data => {
      const statusElement = document.getElementById('status1');
      const nameElement = document.getElementById('name1');

      if (data.status === 'จองแล้ว') {
        statusElement.textContent = 'BOOKED';
        statusElement.style.backgroundColor = '#e53935';
        nameElement.textContent = data.name || '-';
      } else {
        statusElement.textContent = 'AVAILABLE';
        statusElement.style.backgroundColor = '#4caf50';
        nameElement.textContent = '-';
      }
    });
}

updateUI();
setInterval(updateUI, 5000); // อัปเดตทุก 5 วิ
</script>

</body>
</html>