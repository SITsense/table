<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SITsense Table Booking</title>
  <style>
    /* (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) -- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ Style */
  </style>
</head>

<body>

<h1>SITsense</h1>

<!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏ï‡πä‡∏∞ -->
<div id="mainPage">
  <div class="table-card" id="table1">
    <div class="table-name">Table 1</div>
    <p class="info-line">Status: <span id="status1" class="status">AVAILABLE</span></p>
    <p class="info-line">Name: <span id="name1">-</span></p>
    <button id="loginButton1" onclick="goToLogin(1)">Login</button>
    <button id="logoutButton1" class="hidden" onclick="goToLogout(1)">Logout</button>
  </div>

  <div class="table-card" id="table2">
    <div class="table-name">Table 2</div>
    <p class="info-line">Status: <span id="status2" class="status">AVAILABLE</span></p>
    <p class="info-line">Name: <span id="name2">-</span></p>
    <button id="loginButton2" onclick="goToLogin(2)">Login</button>
    <button id="logoutButton2" class="hidden" onclick="goToLogout(2)">Logout</button>
  </div>
</div>

<!-- ‡∏´‡∏ô‡πâ‡∏≤ Login -->
<div id="loginPage" class="hidden">
  <div class="form-card">
    <h2>Login Table <span id="loginTableNumber"></span></h2>
    <input type="text" id="nameInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠" required>
    <input type="text" id="studentIDInput" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 11 ‡∏´‡∏•‡∏±‡∏Å" required>
    <input type="email" id="emailInput" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" required>
    <button onclick="confirmLogin()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô Login</button>
    <button onclick="showMainPage()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
  </div>
</div>

<!-- ‡∏´‡∏ô‡πâ‡∏≤ Logout -->
<div id="logoutPage" class="hidden">
  <div class="form-card">
    <h2>Logout Table <span id="logoutTableNumber"></span></h2>
    <input type="text" id="logoutStudentIDInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô" required>
    <button onclick="confirmLogout()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô Logout</button>
    <button onclick="showMainPage()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
  </div>
</div>

<script>
let selectedTable = null;
const scriptURL = 'https://script.google.com/macros/s/AKfycbz3BAoUZr7_uy2BFocspCqgMlf9lfM_fcUea4J6LWBlinNBR6KjIk2HKNI5sblC6T0/exec'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á

function goToLogin(table) {
  selectedTable = table;
  document.getElementById('mainPage').classList.add('hidden');
  document.getElementById('loginPage').classList.remove('hidden');
  document.getElementById('loginTableNumber').textContent = table;
}

function goToLogout(table) {
  selectedTable = table;
  document.getElementById('mainPage').classList.add('hidden');
  document.getElementById('logoutPage').classList.remove('hidden');
  document.getElementById('logoutTableNumber').textContent = table;
}

function showMainPage() {
  document.getElementById('mainPage').classList.remove('hidden');
  document.getElementById('loginPage').classList.add('hidden');
  document.getElementById('logoutPage').classList.add('hidden');
  document.getElementById('nameInput').value = '';
  document.getElementById('studentIDInput').value = '';
  document.getElementById('emailInput').value = '';
  document.getElementById('logoutStudentIDInput').value = '';
  updateUI();
}

function confirmLogin() {
  const name = document.getElementById('nameInput').value.trim();
  const studentID = document.getElementById('studentIDInput').value.trim();
  const email = document.getElementById('emailInput').value.trim();

  if (!name || !studentID || !email) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
    return;
  }
  if (studentID.length !== 11 || isNaN(studentID)) {
    alert("‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 11 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");
    return;
  }

  // üî• ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
  fetch(scriptURL + `?action=checkStudentID&studentID=${studentID}`)
    .then(response => response.json())
    .then(data => {
      if (data.exists) {
        alert("‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ô‡∏µ‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏µ‡πà‡πÇ‡∏ï‡πä‡∏∞‡∏≠‡∏∑‡πà‡∏ô");
        showMainPage();
      } else {
        // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô ‚Üí ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏ï‡πà‡∏≠
        const user = { name, studentID, email };

        const postData = new URLSearchParams();
        postData.append('action', 'login');
        postData.append('status', '‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß');
        postData.append('name', name);
        postData.append('studentID', studentID);
        postData.append('email', email);
        postData.append('table', selectedTable);

        fetch(scriptURL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: postData
        }).then(response => response.text())
          .then(result => {
            localStorage.setItem(`table${selectedTable}User`, JSON.stringify(user));
            showMainPage();
          }).catch(error => {
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error);
          });
      }
    })
    .catch(error => {
      alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: ' + error);
    });
}

function confirmLogout() {
  const inputID = document.getElementById('logoutStudentIDInput').value.trim();

  const user = JSON.parse(localStorage.getItem(`table${selectedTable}User`));
  if (user && inputID === user.studentID) {
    const postData = new URLSearchParams();
    postData.append('action', 'logout');
    postData.append('studentID', user.studentID);

    fetch(scriptURL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: postData
    }).then(response => response.text())
      .then(result => {
        localStorage.removeItem(`table${selectedTable}User`);
        showMainPage();
      }).catch(error => {
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error);
      });
  } else {
    alert('‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
  }
}

function updateUI() {
  const table1User = JSON.parse(localStorage.getItem('table1User'));
  if (table1User) {
    document.getElementById('status1').textContent = 'BOOKED';
    document.getElementById('status1').style.backgroundColor = '#e53935';
    document.getElementById('name1').textContent = table1User.name;
    document.getElementById('loginButton1').classList.add('hidden');
    document.getElementById('logoutButton1').classList.remove('hidden');
  } else {
    document.getElementById('status1').textContent = 'AVAILABLE';
    document.getElementById('status1').style.backgroundColor = '#4caf50';
    document.getElementById('name1').textContent = '-';
    document.getElementById('loginButton1').classList.remove('hidden');
    document.getElementById('logoutButton1').classList.add('hidden');
  }

  const table2User = JSON.parse(localStorage.getItem('table2User'));
  if (table2User) {
    document.getElementById('status2').textContent = 'BOOKED';
    document.getElementById('status2').style.backgroundColor = '#e53935';
    document.getElementById('name2').textContent = table2User.name;
    document.getElementById('loginButton2').classList.add('hidden');
    document.getElementById('logoutButton2').classList.remove('hidden');
  } else {
    document.getElementById('status2').textContent = 'AVAILABLE';
    document.getElementById('status2').style.backgroundColor = '#4caf50';
    document.getElementById('name2').textContent = '-';
    document.getElementById('loginButton2').classList.remove('hidden');
    document.getElementById('logoutButton2').classList.add('hidden');
  }
}

updateUI();
</script>

</body>
</html>
